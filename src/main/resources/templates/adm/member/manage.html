<!doctype html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/admin}">

<head>
  <title>온라인 마크다운 PPT 서비스! 피피토 | 회원관리 페이지</title>

  <meta id="_csrf" name="_csrf" th:content="${_csrf.token}"/>
  <meta id="_csrf_header" name="_csrf_header" th:content="${_csrf.headerName}"/>

</head>

<div layout:fragment="content">

  <!-- 임시 -->
  <div class="flex flex-col py-4">
    <div class="flex justify-center py-10 rounded-md bg-white shadow p-6">
      <div>
        <div class="flex flex-row mb-4">
          <div class="flex-none px-4 py-1 bg-gray-600 text-gray-300 text-sm rounded-full">
            <span>전체 회원 수 : </span>
            <span th:text="${count}+명"></span>
          </div>
          <div class="flex-grow"></div>
          <div class="flex-none px-4 py-1 bg-gray-600 text-gray-300 text-sm rounded-full">
            <button>선택멤버 차단</button>
          </div>
        </div>
        <div class="flex justify-center">
          <table class="container mx-auto">
            <thead class="bg-gray-100">
            <tr class="w-full text-sm text-gray-500">
              <th class="w-20 p-4"><input type="checkbox"></th>
              <th class="w-40 p-4">회원 아이디</th>
              <th class="w-40 p-4">별명</th>
              <th class="w-30 p-4">현재 권한 상태</th>
              <th class="w-20 p-4">차단</th>
              <th class="w-30 p-4">현재 차단 상태</th>
              <th class="w-20 p-4">수정</th>
              <th class="w-20 p-4">취소</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="member : ${members}" class="text-sm text-gray-500">
              <td class="p-4">
                <input type="checkbox">
              </td>
              <td class="p-4">
                <span th:text="${member.loginId}"></span>
              </td>
              <td class="p-4">
                <span th:text="${member.nickname}"></span>
              </td>
              <td class="p-4">
                <th:block th:with="level=${member.authLevel}">
                  <th:blcok th:switch="${level}">
                    <span th:case="1">준회원</span>
                    <span th:case="3">회원</span>
                    <span th:case="4">차단</span>
                    <span th:case="7">관리자</span>
                  </th:blcok>
                </th:block>
              </td>
              <td class="p-4">
                <button th:onclick="'javascript:blockMember('+ ${member.loginId} + ');'" class="bg-gray-500 hover:bg-black text-white font-bold py-2 px-4 rounded duration-300">B</button>
              </td>
              <td class="p-4">
                <span th:text="${member.blind}">정상(false)</span>
              </td>
              <td class="p-4">
                <a th:text="#{button.modify}" href="#" class="p-2 bg-blue-500 rounded text-white block">수정</a>
              </td>
              <td class="p-4">
                <form id="delete-form" th:action="@{'/members/' + ${member.loginId}}" method="post">
                  <input type="hidden" name="_method" value="delete"/>
                  <button id="delMember" class="p-2 bg-red-500 rounded text-white block" onclick="return confirm('정말 탈퇴시키겠습니까?');">탈퇴</button>
                </form>
<!--                <a th:text="#{button.cancel}" href="/members" class="p-2 bg-red-500 rounded text-white block">탈퇴</a>-->
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script type="text/javascript" src="webjars/jquery/2.2.4/jquery.min.js"></script>

  <script type="text/javascript">
   var token = $("meta[name='_csrf']").attr("content");
   var header = $("meta[name='_csrf_header']").attr("content");

   function blockMember(loginId){

      $.ajax({
          data : JSON.stringify(memberId)
          ,url : "/adm/manage/members/" + loginId
          ,type : "PUT"
          ,datatype : "json"
          ,beforeSend : function(xhr){
              xhr.setRequestHeader(header, token);
          }
          ,success : function() {

              alert("성공");
              location.reload();
          }
          ,error: function () {

              alert('실패');
          }
      });

   }

  </script>

</div>

</html>